{# 
  USPs (Unique Selling Points) Block Template
  -------------------------------------------
  A flexible component for displaying key features or benefits, supporting both
  global sitewide settings and local block configuration. Each USP item includes
  an icon and optional rich text content.

  Features:
  - Global or local configuration options
  - Icon + text layout for each USP item
  - Customizable background color (passed via include or block settings)
  - Rich text content support
  - Responsive layout with flexbox

  Configuration Options:
  Global Mode (useGlobalUsps):
  - USPs from sitewide settings
  - Rich text from sitewide settings

  Local Mode:
  - USPs from block settings
  - Rich text from block settings

  Background Color:
  - Can be passed directly to the include
  - Falls back to block.backgroundColour.color[0].background if not provided

  USP Item Structure:
  - Icon: SVG icon displayed inline
  - Text: Optional rich text content for each USP item
#}

{% import "_macros/utils.twig" as utils %}
{% import "_macros/ui.twig" as ui %}

{# Determine if using global or local settings #}
{%- set useGlobalUsps = useGlobalUsps ?? block.useGlobalUsps ?? false -%}
{%- set useGlobalUspColours = useGlobalUspColours ?? block.useGlobalUspColours ?? false -%}

{# Set configuration based on global/local mode #}
{% if useGlobalUsps %}
  {%- set richText = globalContent.uspsRichText -%}
  {%- set usps = globalContent.usps.all() -%}
{% else %}
  {%- set richText = block.richText -%}
  {%- set usps = block.usps.all() -%}
{% endif %}

{% if useGlobalUspColours %}
  {%- set backgroundColour = globalContent.globalUspsBackgroundColour.color[0].background -%}
  {%- set headingColour = globalContent.globalUspsHeadingColour.color[0].heading -%}
  {%- set textColour = globalContent.globalUspsTextColour.color[0].text -%}
{% else %}
  {%- set backgroundColour = backgroundColour ?? block.backgroundColour.color[0].background -%}
  {%- set headingColour = headingColour ?? block.headingColour.color[0].heading -%}
  {%- set textColour = textColour ?? block.textColour.color[0].text -%}
{% endif %}


{# Main USPs section with styling classes #}
<section class="usps content-block {{ backgroundColour }} {{ headingColour }} {{ textColour }}"
  {{ utils.debugAttributes(entry, 'usps', 'USPs') }}
  {{ utils.inPageLink(block.id) }}
  >
  <div class="content-block-inner container-medium">

    {# Optional rich text content above the USPs #}
    {{ ui.component('rich-text', { 
      content: richText 
    }) }}

    {# USP items grid #}
    <div class="usp-row">
    {% for item in usps %}
      <div class="usp-item">
        <div class="usp-card">
          {# Icon display #}
          <div class="usp-icon">
            {{ item.uspIcon.inline }}
          </div>
          {# Optional rich text content #}
          {% if item.richText|length %}
            <div class="usp-text">
              {{ item.richText }}
            </div>
          {% endif %}
        </div>
      </div>
    {% endfor %}
    </div>
  </div>
</section>